---
import Layout from '@layouts/Layout.astro';
import Article from '@components/projects-detail/section/Article.astro';
import Related from '@components/projects-detail/section/Related.astro';

export async function getStaticPaths() {
  try {
    console.log('🔍 データ取得開始...');

    // per_page=100で最大100件まで取得（WordPressの上限）
    const response = await fetch('https://infocus.wp.site-prev2.com/api/rest/?path=wp/v2/projects&per_page=24');

    if (!response.ok) {
      console.error('❌ APIエラー:', response.status);
      return [];
    }

    const projectsData = JSON.parse(await response.text());
    // 単一オブジェクトの場合は配列に変換
    const projectsArray = Array.isArray(projectsData) ? projectsData : [projectsData];

    console.log('📊 取得したプロジェクト数:', projectsArray.length);
    console.log('🔍 プロジェクト詳細:', projectsArray[0]?.title, projectsArray[0]?.slug);

    // 有効なデータのみをカウント
    const validProjects = projectsArray.filter(item => item.title && item.slug);
    console.log('✅ 有効なプロジェクト数:', validProjects.length);

    return validProjects.map((project) => ({
      params: { slug: project.slug },
      props: { project }
    }));

  } catch (error) {
    console.error('❌ エラー発生:', error);
    return [];
  }
}

// メタデータの設定
const title = '';

const pageMeta = {
  title: title,
  ogpType: "website"
};
---

<Layout
  title={title}
  pageName="project-detail"
  meta={pageMeta}
>

<!-- <Article
  project={project}
  prevProject={prevProject}
  nextProject={nextProject}
/>
{allProjects.length > 0 && (
  <Related projects={allProjects} />
)} -->

</Layout>

<style lang="scss" is:global>
@use '../../assets/scss/mediaquery' as me;
@use '../../assets/scss/mixin' as mi;

</style>

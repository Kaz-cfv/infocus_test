---
import Layout from '@layouts/Layout.astro';
import Article from '@components/projects-detail/section/Article.astro';
import Related from '@components/projects-detail/section/Related.astro';

export async function getStaticPaths() {
  try {
    console.log('ğŸ” ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹...');

    // per_page=100ã§æœ€å¤§100ä»¶ã¾ã§å–å¾—ï¼ˆWordPressã®ä¸Šé™ï¼‰
    const response = await fetch('https://infocus.wp.site-prev2.com/api/rest/?path=wp/v2/projects&per_page=24');

    if (!response.ok) {
      console.error('âŒ APIã‚¨ãƒ©ãƒ¼:', response.status);
      return [];
    }

    const projectsData = JSON.parse(await response.text());
    // å˜ä¸€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã¯é…åˆ—ã«å¤‰æ›
    const projectsArray = Array.isArray(projectsData) ? projectsData : [projectsData];

    console.log('ğŸ“Š å–å¾—ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°:', projectsArray.length);
    console.log('ğŸ” ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°:', projectsArray[0]?.title, projectsArray[0]?.slug);

    // æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
    const validProjects = projectsArray.filter(item => item.title && item.slug);
    console.log('âœ… æœ‰åŠ¹ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°:', validProjects.length);

    return validProjects.map((project) => ({
      params: { slug: project.slug },
      props: { project }
    }));

  } catch (error) {
    console.error('âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ:', error);
    return [];
  }
}

// ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®è¨­å®š
const title = '';

const pageMeta = {
  title: title,
  ogpType: "website"
};
---

<Layout
  title={title}
  pageName="project-detail"
  meta={pageMeta}
>

<!-- <Article
  project={project}
  prevProject={prevProject}
  nextProject={nextProject}
/>
{allProjects.length > 0 && (
  <Related projects={allProjects} />
)} -->

</Layout>

<style lang="scss" is:global>
@use '../../assets/scss/mediaquery' as me;
@use '../../assets/scss/mixin' as mi;

</style>

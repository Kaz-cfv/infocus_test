---
// Propså‹å®šç¾© - ç©ºã®Propsã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§å‹•çš„ã«è¨­å®š
export interface Props {}
---

<div class="p-home-kv" data-video id="kvContainer">
  <div class="p-home-kv__item">
    <video
      id="kvVideo"
      autoplay
      muted
      loop
      playsinline
      class="p-home-kv__video"
    >
    </video>
  </div>
</div>

<!-- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§APIãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ -->
<script>
  // ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã§APIãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
  document.addEventListener('homeDataLoaded', (event) => {
    const homeData = (event as CustomEvent).detail;

    // ãƒ’ãƒ¼ãƒ­ãƒ¼å‹•ç”»ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†
    let heroMovie = null;

    // ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«å¿œã˜ã¦æŸ”è»Ÿã«å¯¾å¿œ
    let herosData = null;
    if (homeData?.heros) {
      herosData = homeData.heros;
    } else if (homeData?.home?.heros) {
      herosData = homeData.home.heros;
    }

    if (herosData && Array.isArray(herosData) && herosData.length > 0) {
      // è¤‡æ•°ã®å‹•ç”»ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤ã‚’é¸æŠ
      const randomIndex = Math.floor(Math.random() * herosData.length);
      const selectedHero = herosData[randomIndex];

      // movieãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰å‹•ç”»URLã‚’å–å¾—
      heroMovie = selectedHero.movie || null;
      // console.log('ğŸ¥ å‹•ç”»URLã‚’å–å¾—:', heroMovie);
    }

    // å‹•ç”»URLã‚’videoã‚¿ã‚°ã«è¨­å®š
    const videoElement = document.getElementById('kvVideo');
    if (videoElement && heroMovie) {
      // HTMLVideoElementã¨ã—ã¦å‹ã‚­ãƒ£ã‚¹ãƒˆ
      const video = videoElement as HTMLVideoElement;
      video.src = heroMovie;

      video.addEventListener('error', (e) => {
        console.error('âŒ å‹•ç”»ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
      });

    } else {
      console.warn('âš ï¸ å‹•ç”»URLãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', {
        videoElement: !!videoElement,
        heroMovie: heroMovie
      });
    }
  });
</script>

<style lang="scss">
@use '../../../assets/scss/mediaquery' as me;
@use '../../../assets/scss/mixin' as mi;

.p-home-kv {
  overflow: hidden;

  &__item {
    position: relative;
    @include me.pc {
      aspect-ratio: 1440 / 563;
      width: 100%;
    }
    @include me.sp {
      aspect-ratio: 4 / 5;
      width: 100%;
    }
  }

  &__video {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
}

</style>

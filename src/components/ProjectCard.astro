---
interface Tag {
  name: string;
  url: string;
}

interface Props {
  id: number;
  title: string;
  tags: Tag[];
  imageSrc: string;
  videoSrc?: string;
  imageAlt?: string;
  url?: string;
  type?: string;
}

const {
  id = '',
  title,
  tags,
  imageSrc,
  videoSrc,
  imageAlt = "Projects Image",
  url = "#",
  type = ""
} = Astro.props;
---

<div class="c-project-card mouse-over" data-id={id} data-type={type}>
  <a href={url} class="c-project-card__image-wrapper">
    <img src={imageSrc} alt={imageAlt} class="c-project-card__image">
    {videoSrc && (
      <video
        src={videoSrc}
        class="c-project-card__video"
        muted
        loop
        playsinline
        preload="metadata"
      ></video>
    )}
  </a>
  <div class="c-project-card__content">
    <h3 class="c-project-card__title">
      <a href={url}>{title}</a>
    </h3>
    <div class="c-project-card__tags js-hover">
      {tags.map((tag, index) => (
        <>
          <a href={tag.url} class="c-project-card__category js-hover-item">{tag.name}</a>
          {index < tags.length - 1 && <span class="c-project-card__separator js-hover-item">,</span>}
        </>
      ))}
    </div>
  </div>
</div>

<style lang="scss">
@use '../assets/scss/_mediaquery' as me;
@use '../assets/scss/_mixin' as mi;

.c-project-card {
  display: flex;
  flex-direction: column;
  position: relative;
  transition: opacity 0.3s ease-out;
  height: 100%;

  @include me.pc {
    &.mouse-over {
      &:hover {
        .c-project-card__image-wrapper {
          // 各辺から10px内側にクリップ（360px → 340px相当）
          clip-path: inset(7px);
        }

        .c-project-card__image,
        .c-project-card__video {
          // 画像自体を拡大（360px → 368px相当）
          // transform: scale(1.0222); // 368/360 = 1.0222
        }
      }
    }
  }

  &[data-type="cover"] {
    height: 100%;
  }

  &__image-wrapper {
    display: block;
    position: relative;
    overflow: hidden;
    aspect-ratio: 16 / 9;
    clip-path: inset(0px);
    transition: clip-path .4s cubic-bezier(0.16, 1.02, 0.52, 1.03);
    @at-root [data-type="pickup"] & {
      @include me.pc {
        margin-top: 30px;
        margin-inline: 30px;
      }
    }
    @at-root [data-type="cover"] & {
      aspect-ratio: 1 / 1;
      @include me.pc {
        flex: 1;
      }
      @include me.sp {
        aspect-ratio: unset;
        height: 100%;
        min-height: 100%;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }
    }
  }

  &__image {
    @include mi.absolute-all;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  &__video {
    @include mi.absolute-all;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 1;
  }

  &__content {
    display: flex;
    flex-direction: column;
    margin-top: 16px;
    @include me.pc {
      row-gap: 8px;
    }
    @at-root [data-type="cover"] & {
      display: none;
    }
  }

  &__title {
    a {
      color: var(--c-white);
      font-size: 1.4rem;
      font-weight: 700;
      line-height: 2rem;
      @include me.sp {
        font-size: 1.6rem;
      }
      @at-root [data-type="pickup"] & {
        font-size: 2rem;
        @include me.sp {
          font-size: 1.8rem;
        }
      }
    }
  }

  &__tags {
    font-size: 1.2rem;
    font-weight: 600;
    line-height: 2.32rem;
    @include me.sp {
      font-size: 1.4rem;
    }
    @at-root [data-type="pickup"] & {
      font-size: 1.4rem;
      @include me.sp {
        font-size: 1.2rem;
      }
    }
  }

  &__category {
    display: inline-block;
    color: var(--c-gray);
  }

  &__separator {
    color: var(--c-gray);
    margin-inline-end: 4px;
  }

  // アクティブ状態のスタイル（まるで重要な証拠が光るように）
  &.is-play {
    .c-project-card__video {
      // 動画再生中の特別なスタイルがあれば追加
    }

    // 微細なボーダー効果（公安の精密な技術のように）
    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 2px solid rgba(255, 255, 255, 0.3);
      pointer-events: none;
      z-index: 2;
      opacity: 0;
      animation: fadeInBorder 0.3s ease-out forwards;
    }
  }
}

@keyframes fadeInBorder {
  to {
    opacity: 1;
  }
}
</style>

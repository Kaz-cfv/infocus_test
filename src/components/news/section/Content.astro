---
import NewsCard from "../parts/NewsCard.astro";
import Info from "../parts/Info.astro";
import Pagination from '../parts/Pagination.astro';

// スケルトンカードの枚数
const PICKUP_SKELETON_COUNT = 1; // ピックアップ固定エリア用
const PICKUP_LIST_SKELETON_COUNT = 3; // ピックアップリスト用（2〜4件目）
const MAIN_SKELETON_COUNT = 14; // メインリスト用
---

<section class="p-news-content" data-main-content>
  <div class="p-news-pickup__list" data-pickup-section>
    <div class="p-news-pickup__list-fixedItem">
      <div class="p-news-pickup__list-fixedInner">
        <h2 class="p-news-pickup__list-fixedTitle">
          PICK UP
          <span><svg width="11" height="17" viewBox="0 0 11 17" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_240_384)"><path d="M11 11.7419V10.0008L9.19249 6.95043L10.6127 0H0.387324L1.81397 6.95043L0 10.0008V11.7419H11Z" fill="white"/><path d="M6.10035 8.13477H4.89964V17.0004H6.10035V8.13477Z" fill="white"/></g><defs><clipPath id="clip0_240_384"><rect width="11" height="17" fill="white"/></clipPath></defs></svg></span>
        </h2>

        <!-- ピックアップ固定エリア用スケルトン -->
        {Array.from({ length: PICKUP_SKELETON_COUNT }).map((_, index) => (
          <div class="c-news-card skeleton skeleton-item" data-skeleton="pickup-fixed">
            <figure class="c-news-card__pic skeleton-shimmer"></figure>
            <div class="c-news-card__info">
              <div class="skeleton-title skeleton-shimmer"></div>
              <div class="c-news-card__info-sub">
                <div class="skeleton-date skeleton-shimmer"></div>
                <div class="skeleton-category skeleton-shimmer"></div>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- ピックアップリスト用スケルトン -->
    <ul class="p-news-pickup__list-index">
      {Array.from({ length: PICKUP_LIST_SKELETON_COUNT }).map((_, index) => (
        <li class="p-news-pickup__list-item skeleton-item" data-skeleton="pickup-list">
          <div class="c-news-card skeleton">
            <figure class="c-news-card__pic skeleton-shimmer"></figure>
            <div class="c-news-card__info">
              <div class="skeleton-title skeleton-shimmer"></div>
              <div class="c-news-card__info-sub">
                <div class="skeleton-date skeleton-shimmer"></div>
                <div class="skeleton-category skeleton-shimmer"></div>
              </div>
            </div>
          </div>
        </li>
      ))}
    </ul>
  </div>

  <!-- INFO -->
   <Info />

  <!-- メインリスト用スケルトン -->
  <div class="p-news-content__list">
    <ul class="p-news-content__list-index" data-index="news">
      {Array.from({ length: MAIN_SKELETON_COUNT }).map((_, index) => (
        <li class="p-news-content__list-item skeleton-item" data-skeleton="main">
          <div class="c-news-card skeleton">
            <figure class="c-news-card__pic skeleton-shimmer"></figure>
            <div class="c-news-card__info">
              <div class="skeleton-title skeleton-shimmer"></div>
              <div class="c-news-card__info-sub">
                <div class="skeleton-date skeleton-shimmer"></div>
                <div class="skeleton-category skeleton-shimmer"></div>
              </div>
            </div>
          </div>
        </li>
      ))}
    </ul>
  </div>

  <!-- {allNews.length > 17 && <Pagination />} -->
   <div class="pagination-container" style="display: none;">
    <Pagination />
  </div>
</section>

<style lang="scss" is:global>
@use '../../../assets/scss/mediaquery' as me;
@use '../../../assets/scss/mixin' as mi;

.p-news-content {
  padding-inline: 30px;
  padding-block-end: 160px;
  @include me.sp {
    margin-block-start: 60px;
    padding-inline: 20px;
    padding-block-end: 100px;
  }

  &__list {

    &-index {
      display: grid;
      @include me.sp {
        row-gap: 50px;
        margin-block-start: 50px;
      }
    }

    &-item {
      @include me.pc {
        padding-block: 20px;
        border-bottom: solid 1px var(--c-gray);
      }

      // ★ メインリストのフェードインアニメーション
      &:not(.skeleton-item) {
        opacity: 0;
        animation: fadeIn 0.6s ease-out forwards;

        // 順次表示のための遅延
        @for $i from 1 through 20 {
          &:nth-child(#{$i}) {
            animation-delay: #{($i - 1) * 0.05}s;
          }
        }
      }
    }
  }
}

.p-news-pickup {

  &__list {
    @include me.pc {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      column-gap: 30px;
      margin-block-start: 114px;
      border-bottom: solid 1px var(--c-gray);
    }

    &-fixedItem {
      @include me.pc {
        padding-block-end: 100px;
      }
    }

    &-fixedInner {
      @include me.pc {
        position: sticky;
        top: calc(var(--hd-height-pc-scrolled) + 120px + 20px);
        left: 0;
      }

      // ★ ピックアップ固定エリアのフェードインアニメーション
      .c-news-card:not(.skeleton) {
        opacity: 0;
        animation: fadeIn 0.6s ease-out forwards;
      }
    }

    &-fixedTitle {
      display: flex;
      align-items: center;
      column-gap: 9px;
      font-size: 2.4rem;
      @include me.pc {
        position: absolute;
        bottom: calc(100% + 20px);
        left: 0;
      }
      @include me.sp {
        column-gap: 4px;
        margin-block-end: 20px;
        font-size: 1.8rem;
      }

      span {
        display: flex;
        justify-content: center;
        align-items: center;
        transform: translateY(2px);
        width: 11px;
        height: 17px;
        @include me.sp {
          transform: translateY(1px);
          width: calc(11px * .8);
          height: calc(17px * .8);
        }
      }
    }

    &-index {
      display: grid;
      @include me.pc {
        row-gap: 70px;
        position: relative;
        padding-block-end: 100px;
        &::before {
          content: "";
          position: absolute;
          top: 0;
          left: -15px;
          width: 1px;
          height: 100%;
          background-color: var(--c-gray);
        }
      }
      @include me.sp {
        row-gap: 50px;
        margin-block-start: 50px;
        padding-block-start: 50px;
        border-top: solid 1px var(--c-gray);
      }
    }

    // ★ ピックアップリストのフェードインアニメーション
    &-item {
      &:not(.skeleton-item) {
        opacity: 0;
        animation: fadeIn 0.6s ease-out forwards;

        // 順次表示のための遅延
        @for $i from 1 through 5 {
          &:nth-child(#{$i}) {
            animation-delay: #{($i - 1) * 0.1}s;
          }
        }
      }
    }

    .c-news-card {
      @include me.pc {
        grid-template-columns: 100%;
        row-gap: 33px;
      }
    }
  }
}

// ★ フェードインアニメーション（動きなし）
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

// ★ スケルトンカードのスタイル
.skeleton-item {
  pointer-events: none;
  user-select: none;
}

.c-news-card.skeleton {
  .c-news-card__pic {
    background: #1a1a1a;
    aspect-ratio: 389 / 218.64;

    &.skeleton-shimmer {
      position: relative;
      overflow: hidden;

      &::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          transparent 0%,
          rgba(255, 255, 255, 0.03) 50%,
          transparent 100%
        );
        animation: shimmer 1.5s infinite;
      }
    }
  }

  .c-news-card__info {
    row-gap: 10px;
  }
}

.skeleton-title {
  height: 1.8rem;
  width: 85%;
  background: #1a1a1a;
  border-radius: 4px;

  @include me.sp {
    height: 1.6rem;
  }
}

.skeleton-date {
  height: 1.6rem;
  width: 80px;
  background: #1a1a1a;
  border-radius: 4px;

  @include me.sp {
    height: 1.4rem;
  }
}

.skeleton-category {
  height: 1.6rem;
  width: 60px;
  background: #1a1a1a;
  border-radius: 4px;

  @include me.sp {
    height: 1.4rem;
  }
}

@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

// フェードアウトアニメーション
@keyframes skeleton-fade-out {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}

.skeleton-item.fade-out,
.c-news-card.skeleton.fade-out {
  animation: skeleton-fade-out 0.3s ease-out forwards;
}

.c-news-card {
  display: grid;
  color: var(--c-white);
  @include me.pc {
    grid-template-columns: 389px 1fr;
    column-gap: 40px;

    &.mouse-over {
      &:hover {
        .c-news-card__pic {
          clip-path: inset(7px);
        }

        .c-news-card__pic img {
          // transform: scale(1.0222);
        }
      }
    }
  }
  @include me.sp {
    grid-template-columns: 100%;
    row-gap: 14px;
  }

  &__pic {
    aspect-ratio: 389 / 218.64;
    clip-path: inset(0px);
    transition: clip-path .4s cubic-bezier(0.16, 1.02, 0.52, 1.03);

    img {
      transition: transform 0.3s cubic-bezier(0, 0, 0.17, 1);
    }
    picture {
      display: block;
      width: 100%;
      height: 100%;
    }
  }

  &__info {
    display: grid;
    grid-template-columns: 100%;
    align-content: flex-start;
    row-gap: 10px;
    @include me.pc {
      padding-block-start: 10px;
    }
    @include me.sp {
      row-gap: 8px;
    }

    &-title {
      font-size: 1.8rem;
      font-weight: 600;
      line-height: 1.6;
      @include me.sp {
        font-size: 1.6rem;
      }
    }

    &-sub {
      display: flex;
      align-items: center;
      column-gap: 4px;
      color: var(--c-gray);
      font-size: 1.6rem;
      font-weight: 500;
      @include me.sp {
        font-size: 1.4rem;
      }
    }

    &-date {
      display: flex;
      align-items: center;
      column-gap: 4px;
      &::after {
        content: "-";
        display: inline-block;
      }
    }

  }

}
</style>
